<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kontakt</title>
    <link rel="icon" type="image/svg+xml" href="img/favicon.svg">
    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/app.css">

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script></head>

<body class="flex flex-col h-screen text-hptext-500"><nav x-data="{ isDrawerMenu: window.innerWidth &lt; 767, isMenuShown: false }" x-on:keydown.escape="isMenuShown = false" x-on:click.away="isMenuShown = false" x-on:resize.window.debounce.100="isDrawerMenu = window.innerWidth &lt; 640" class="bg-[linear-gradient(to_bottom,rgba(255,255,255,0.0),rgba(255,255,255,0.7)),url(&#x27;../img/HeaderBackground.svg&#x27;)] bg-cover bg-no-repeat bg-center flex flex-col justify-start items-center"><div class="flex flex-row items-start justify-between w-full px-4 py-4 sm:justify-center"><a href="/"><img src="img/logo_long.svg" alt="logo" class="pr-4 max-h-16 sm:hidden" style="transform-box: fill-box;">
      <img src="img/logo_round.svg" alt="logo" class="hidden h-16 sm:block md:h-48 sm:h-28"></a>
    <button x-on:click="isMenuShown = !isMenuShown" type="button" aria-label="Toggle menu" class="sm:hidden"><svg x-show="!isMenuShown" width="24" height="24" viewBox="0,0,24,24" focusable="false" aria-hidden="true"><path d="M4 18q-.425 0-.712-.288Q3 17.425 3 17t.288-.712Q3.575 16 4 16h16q.425 0 .712.288.288.287.288.712t-.288.712Q20.425 18 20 18Zm0-5q-.425 0-.712-.288Q3 12.425 3 12t.288-.713Q3.575 11 4 11h16q.425 0 .712.287.288.288.288.713t-.288.712Q20.425 13 20 13Zm0-5q-.425 0-.712-.287Q3 7.425 3 7t.288-.713Q3.575 6 4 6h16q.425 0 .712.287Q21 6.575 21 7t-.288.713Q20.425 8 20 8Z"/></svg>
      <svg x-show="isMenuShown" width="24" height="24" viewBox="0,0,24,24" focusable="false" aria-hidden="true"><path d="m12 13.4-4.9 4.9q-.275.275-.7.275-.425 0-.7-.275-.275-.275-.275-.7 0-.425.275-.7l4.9-4.9-4.9-4.9q-.275-.275-.275-.7 0-.425.275-.7.275-.275.7-.275.425 0 .7.275l4.9 4.9 4.9-4.9q.275-.275.7-.275.425 0 .7.275.275.275.275.7 0 .425-.275.7L13.4 12l4.9 4.9q.275.275.275.7 0 .425-.275.7-.275.275-.7.275-.425 0-.7-.275Z"/></svg></button></div>
  <div x-bind:class="{ &#x27;hidden&#x27;: isDrawerMenu ? !isMenuShown : false }" class="flex flex-col gap-4 px-8 pb-2 mx-8 border-b-2 sm:justify-center sm:gap-8 sm:flex-row border-hptext-300"><a href="index" class=" font-semibold text-nowrap whitespacing-no-wrap text-xl hover:scale-95 transition">Home</a>
    <a href="Leistungen" class=" font-semibold text-nowrap whitespacing-no-wrap text-xl hover:scale-95 transition">Leistungen</a>
    <a href="&#xDC;berMich" class=" font-semibold text-nowrap whitespacing-no-wrap text-xl hover:scale-95 transition">&#xDC;ber mich</a>
    <a href="Kontakt" class="text-hpaccent-500 font-semibold text-nowrap whitespacing-no-wrap text-xl hover:scale-95 transition">Kontakt</a></div></nav>

    <main class="flex flex-col items-center p-4 pb-16 md:p-8 md:pb-16 grow"><div class="sm:w-3/4 sm:max-w-[500px] w-full"><form x-data="contact" method="post" x-on:submit.prevent="validateAndSubmit($event.target);" class="flex flex-col gap-4 font-medium" action="https://script.google.com/macros/s/AKfycby6bt3TLCr-cdzRq9kvbVrp36o3qd7urLGFRRN0jPOp3Xf7TRxKOdlWbP0gflcAXPco/exec?action=form" novalidate><div class="flex flex-col space-y-1 "><label for="reason-input" class="text-sm">Grund der Anfrage *</label><select id="reason-input" name="reason" class="rounded" required x-model="reason"><option value>--Bitte ausw&#xE4;hlen--</option>
        <option value="Erstgespräch Ernährungsberatung">Erstgespräch Ernährungsberatung</option>
            <option value="Vortrag oder Seminar">Vortrag oder Seminar</option>
            <option value="Sonstiges">Sonstiges</option></select>

    <span class="text-sm text-red-500" x-show="errors.reason"><div x-text="errors.reason"></div></span></div>
        <div class="flex flex-col space-y-1 "><label for="name-input" class="text-sm">Name *</label><input id="name-input" type="text" name="name" class="rounded" required placeholder="Name" x-model="name" />

    <span class="text-sm text-red-500" x-show="errors.name"><div x-text="errors.name"></div></span></div>
        <div class="flex flex-col space-y-1 "><label for="mail-input" class="text-sm">Email *</label><input id="mail-input" type="email" name="mail" class="rounded" required placeholder="Email" x-model="email" />

    <span class="text-sm text-red-500" x-show="errors.email"><div x-text="errors.email"></div></span></div>
        <div class="flex flex-col space-y-1 "><label for="message-input" class="text-sm">Nachricht</label><textarea id="message-input" maxlength="524288" name="message" class="rounded" rows="4" placeholder="Nachricht" x-model="message"></textarea>

    <span class="text-sm text-red-500" x-show="errors.message"><div x-text="errors.message"></div></span></div>
        <input id="c737e082-5be1-405b-a99d-82e5be9ca423" type="Text" name="test" hidden />
        <div class="flex flex-col space-y-1"><label for="captcha-input" class="text-sm">Überprüfung, dass Du ein Mensch bist</label>
            <div class="flex flex-col sm:flex-row items-stretch border rounded h-24 sm:h-16" x-on:resize.window.debounce.500="windowSizeChanged()"><div class="w-full overflow-hidden" id="captchaCanvasContainer"><canvas id="captchaCanvas"></canvas></div>
    <div class="flex flex-row border-t sm:border-t-0"><button type="button" title="Reload captcha" x-on:click="generateMathCaptcha()" class="flex items-center justify-center p-1 transition hover:fill-hpaccent-500 border-r grow sm:px-4 sm:border-x"><svg class="w-4 sm:w-6 " width="24" height="24" viewBox="0,0,24,24" focusable="false" aria-hidden="true"><path d="M12 20q-3.35 0-5.675-2.325Q4 15.35 4 12q0-3.35 2.325-5.675Q8.65 4 12 4q1.725 0 3.3.713 1.575.712 2.7 2.037V5q0-.425.288-.713Q18.575 4 19 4t.712.287Q20 4.575 20 5v5q0 .425-.288.712Q19.425 11 19 11h-5q-.425 0-.712-.288Q13 10.425 13 10t.288-.713Q13.575 9 14 9h3.2q-.8-1.4-2.187-2.2Q13.625 6 12 6 9.5 6 7.75 7.75T6 12q0 2.5 1.75 4.25T12 18q1.725 0 3.188-.913 1.462-.912 2.187-2.437.125-.275.413-.462.287-.188.587-.188.575 0 .863.4.287.4.062.9-.95 2.125-2.925 3.412Q14.4 20 12 20Z"/></svg></button>
        <button type="button" title="Play captcha audio" x-on:click="readCaptchaUsingAudioFiles()" class="flex items-center justify-center p-1 transition hover:fill-hpaccent-500 sm:px-4 grow"><svg class="w-4 sm:w-6 " width="24" height="24" viewBox="0,0,24,24" focusable="false" aria-hidden="true"><path d="M15.35 20.3q-.5.2-.925-.125-.425-.325-.425-.9 0-.275.163-.487.162-.213.412-.313 2-.8 3.213-2.55Q19 14.175 19 11.975t-1.212-3.95q-1.213-1.75-3.213-2.55-.275-.1-.425-.325-.15-.225-.15-.5 0-.55.425-.875.425-.325.925-.125 2.55 1.025 4.1 3.275Q21 9.175 21 11.975t-1.55 5.05q-1.55 2.25-4.1 3.275ZM4 15q-.425 0-.712-.288Q3 14.425 3 14v-4q0-.425.288-.713Q3.575 9 4 9h3l3.3-3.3q.475-.475 1.087-.213.613.263.613.938v11.15q0 .675-.613.937-.612.263-1.087-.212L7 15Zm10 1V7.95q1.125.525 1.812 1.625.688 1.1.688 2.425 0 1.325-.688 2.4Q15.125 15.475 14 16Zm-4-7.15L7.85 11H5v2h2.85L10 15.15ZM7.5 12Z"/></svg></button></div></div>

<script>
    var initialWindowWidth = window.innerWidth;
    var captchaSrcText = "";
    var captchaResult = -1;
    var mathCaptcha = {
        numberPartOne: "",
        numberPartTwo: "",
        numberPartThree: "",
        operationOne: "",
        operationTwo: ""
    };

    generateMathCaptcha();

    function windowSizeChanged() {
        if (window.innerWidth !== initialWindowWidth) {
            initialWindowWidth = window.innerWidth;
            drawMathCaptcha();
        }
    }
    function generateSimpleCaptcha() {
        getRandomCaptcha();
        drawSimpleCaptcha();
    }

    function generateMathCaptcha() {
        getRandomMathCaptcha();
        drawMathCaptcha();
    }

    // Generate a random alphanumeric string
    function getRandomCaptcha() {
        captchaResult = Math.random().toString(36).substring(2, 8);
        captchaSrcText = captchaResult;
    }

    // Randomly generate two numbers and two operations
    // Ensures that the result is always positive
    function getRandomMathCaptcha() {
        const numbersAsText = ["Null", "Eins", "Zwei", "Drei", "Vier", "Fünf", "Sechs", "Sieben", "Acht", "Neun"];
        const operations = ["+", "-"];

        // Reset current captcha
        captchaResult = -1;

        let numberOne;
        let numberTwo;
        let numberThree;

        while (captchaResult < 0) {
            numberOne = 1 + getIntRandomArbitrary(0, 9);
            numberTwo = 1 + getIntRandomArbitrary(0, 9);
            numberThree = 1 + getIntRandomArbitrary(0, 9);

            mathCaptcha.operationOne = operations[getIntRandomArbitrary(0, operations.length)];
            mathCaptcha.operationTwo = operations[getIntRandomArbitrary(0, operations.length)];

            // Calculate the answer for validation (assuming left-to-right evaluation without operator precedence)
            captchaResult = eval(`${numberOne} ${mathCaptcha.operationOne} ${numberTwo} ${mathCaptcha.operationTwo} ${numberThree}`);
        }

        // Decide the form (text/numeric) for each number
        mathCaptcha.numberPartOne = getBoolRandom() ? numbersAsText[numberOne] : numberOne.toString();
        mathCaptcha.numberPartTwo = getBoolRandom() ? numbersAsText[numberTwo] : numberTwo.toString();
        mathCaptcha.numberPartThree = getBoolRandom() ? numbersAsText[numberThree] : numberThree.toString();

        // Generate the captcha string
        captchaSrcText = `${numberOne} ${mathCaptcha.operationOne} ${numberTwo} ${mathCaptcha.operationTwo} ${numberThree}`;
    }

    function drawSimpleCaptcha() {
        const charPadding = 10;
        const minRotation = -0.25;
        const maxRotation = 0.25;
        const minYOffset = -10;
        const maxYOffset = 10;

        // Get and reset canvas
        const canvas = document.getElementById("captchaCanvas");
        canvas.width = document.getElementById("captchaCanvasContainer").clientWidth;
        canvas.height = document.getElementById("captchaCanvasContainer").clientHeight;

        // Set the font size based on the canvas height
        const fontSize = canvas.height / 3;

        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = `${fontSize}px Arial`;
        ctx.textBaseline = 'middle';
        ctx.fillStyle = "#000000";

        // Calculate total width of the text
        let totalWidth = 0;
        for (let i = 0; i < captchaResult.length; i++) {
            totalWidth += ctx.measureText(captchaResult[i]).width + charPadding;
        }

        // Calculate the starting X position to center the text
        const xStartPos = (canvas.width - totalWidth) / 2;

        // Calculate the starting Y position to center the text
        // Approximate text height calculation
        const textHeight = fontSize * 1.2;
        const yStartPos = (canvas.height - textHeight) / 2 + textHeight / 2;

        let xPos = xStartPos;

        // Draw each character with random rotation and y offset
        for (let i = 0; i < captchaResult.length; i++) {
            let text = captchaResult[i];

            // Apply random rotation
            ctx.save();
            ctx.translate(xPos, yStartPos);
            // Rotate by random radians between minRotation and maxRotation
            ctx.rotate(getFloatRandomArbitrary(minRotation, maxRotation));
            // Move the context back to the original position
            ctx.translate(-xPos, -yStartPos);

            // Calculate yPos with a random offset
            let yPos = yStartPos + getFloatRandomArbitrary(minYOffset, maxYOffset);

            // Draw the character
            ctx.fillText(text, xPos, yPos);

            // Restore the context to remove the rotation and translation
            ctx.restore();

            // Update xPos for the next char, include padding
            xPos += ctx.measureText(text).width + charPadding;
        }

        // Fill background with random noise
        fillBackgroundWithDots(ctx, canvas.width, canvas.height, 100);
    }

    function drawMathCaptcha() {
        const partsPadding = 20;
        const minYOffset = -10;
        const maxYOffset = 10;

        // Get and reset canvas
        const canvas = document.getElementById("captchaCanvas");
        canvas.width = document.getElementById("captchaCanvasContainer").clientWidth;
        canvas.height = document.getElementById("captchaCanvasContainer").clientHeight;

        // Set the font size based on the canvas height
        const fontSize = canvas.height / 3;

        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = `bold ${fontSize}px Arial`;
        ctx.textBaseline = 'middle';
        ctx.fillStyle = "#000000";

        // Split the captcha string into parts for individual rendering
        const parts = [
            mathCaptcha.numberPartOne,
            mathCaptcha.operationOne,
            mathCaptcha.numberPartTwo,
            mathCaptcha.operationTwo,
            mathCaptcha.numberPartThree
        ];

        // Calculate the total width of the captcha string
        let totalWidth = 0;

        parts.forEach(part => {
            totalWidth += ctx.measureText(part).width + partsPadding;
        });
        totalWidth -= partsPadding; // Remove extra spacing after the last part

        // Calculate the starting X position to center the text
        const xStartPos = (canvas.width - totalWidth) / 2;

        // Calculate the starting Y position to center the text
        // Approximate text height calculation
        const textHeight = fontSize * 1.2;
        const yStartPos = (canvas.height - textHeight) / 2 + textHeight / 2;

        let xPos = xStartPos;

        // Draw each part to the canvas
        parts.forEach((part, index) => {
            // Apply slight randomness to y position
            const randomYPos = yStartPos + getFloatRandomArbitrary(minYOffset, maxYOffset);

            // Draw the part
            ctx.fillText(part, xPos, randomYPos);

            // Update xPos for the next part, include padding
            xPos += ctx.measureText(part).width + partsPadding;
        });

        // Fill background with random noise
        fillBackgroundWithDots(ctx, canvas.width, canvas.height, 100);
    }

    function fillBackgroundWithDots(ctx, width, height, numDots) {
        for (let i = 0; i < numDots; i++) {
            const xPos = Math.random() * width;
            const yPos = Math.random() * height;
            const diameter = getFloatRandomArbitrary(1, 3);
            const grayValue = getIntRandomArbitrary(100, 255);
            ctx.fillStyle = `rgb(${grayValue}, ${grayValue}, ${grayValue})`;
            ctx.fillRect(xPos, yPos, diameter, diameter);
        }
    }

    function readCaptchaUsingSpeechSynthesis() {
        // Check if the SpeechSynthesisUtterance API is supported
        if (!('speechSynthesis' in window && typeof SpeechSynthesisUtterance !== 'undefined')) {
            alert("Sprachausgabe wird in Ihrem Browser nicht unterstützt.");
            return;
        }

        // Replace math operators with text
        const textToRead = captchaSrcText
            .replace(/\+/g, " plus ")
            .replace(/-/g, " minus ")
            .replace(/\*/g, " mal ")
            .replace(/\//g, " geteilt durch ");

        const utterance = new SpeechSynthesisUtterance(textToRead);
        utterance.rate = 0.5;
        utterance.lang = "de-DE";

        speechSynthesis.speak(utterance);
    }

    function readCaptchaUsingAudioFiles(textPartSeparator = " ") {
        // Define the mapping of text to audio files
        const audioMap = {
            '1': 'audio/de_1.mp3',
            '2': 'audio/de_2.mp3',
            '3': 'audio/de_3.mp3',
            '4': 'audio/de_4.mp3',
            '5': 'audio/de_5.mp3',
            '6': 'audio/de_6.mp3',
            '7': 'audio/de_7.mp3',
            '8': 'audio/de_8.mp3',
            '9': 'audio/de_9.mp3',

            '+': 'audio/de_plus.mp3',
            '-': 'audio/de_minus.mp3',
            '*': 'audio/de_mal.mp3',
            '/': 'audio/de_geteilt.mp3'
        };

        // Function to play audio files in sequence
        function playSequence(elements, index = 0) {
            // Stop when all elements are played
            if (index >= elements.length)
                return;

            const audioSrc = audioMap[elements[index]];
            if (!audioSrc) {
                console.error(`Audio source not found for: ${elements[index]}`);
                return;
            }

            const audio = new Audio(audioSrc);
            audio.onended = () => playSequence(elements, index + 1); // Play next on end
            audio.play();
        }

        // Parse captchaText to individual elements
        const elements = captchaSrcText.split(textPartSeparator);

        // Start playing the sequence
        playSequence(elements);
    }

    /**
     * Generates a random floating-point number within a specified range.
     * 
     * param {number} min - The minimum value (inclusive) of the range.
     * param {number} max - The maximum value (exclusive) of the range.
     * returns {number} A random floating-point number between min (inclusive) and max (exclusive).
     */
    function getFloatRandomArbitrary(min, max) {
        return Math.random() * (max - min) + min;
    }

    /**
     * Generates a random integer within a specified range.
     * 
     * param {number} min - The minimum value (inclusive) of the range.
     * param {number} max - The maximum value (exclusive) of the range.
     * returns {number} A random integer between min (inclusive) and max (exclusive).
     */
    function getIntRandomArbitrary(min, max) {
        return Math.floor(Math.random() * (max - min) + min);
    }

    /**
     * Generates a boolean value based on a random number.
     * This function returns true if the generated random number is greater than 0.5, otherwise false.
     * returns bool - The boolean result of the random number comparison.
     */
    function getBoolRandom() {
        return Math.random() > 0.5;
    }
</script>
            <div class="flex flex-col space-y-1 "><input id="captcha-input" type="text" name="captcha" class="rounded" required placeholder="Rechenergebnis eingeben" x-model="captcha" />

    <span class="text-sm text-red-500" x-show="errors.captcha"><div x-text="errors.captcha"></div></span></div></div>
        <button type="submit" class="transition border rounded bg-hpsecondary-500 hover:bg-hpsecondary-400">Abschicken</button></form></div></main>

    <div class="bg-[linear-gradient(to_top,rgba(255,255,255,0.0),rgba(255,255,255,0.7)),url(&#x27;../img/HeaderBackground.svg&#x27;)] bg-cover bg-no-repeat bg-center flex flex-col justify-start items-center p-4 gap-4"><p>&#xA9; 2024 - 2024 Tamara Lude.</p>
  <div class="flex flex-col items-center gap-2 mx-8 sm:gap-8 sm:justify-center sm:flex-row"><a class="no-underline hover:underline cursor-pointer " href="Impressum">Impressum</a>
    <a href="https://www.instagram.com/herbivorepower" title="instagram" target="_blank" class="transition hover:fill-hpaccent-500"><svg width="24" height="24" viewBox="0,0,448,512" focusable="false" aria-hidden="true"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg></a></div>
  <p class="max-w-screen-md text-center">
    Mein Angebot richtet sich an gesunde Menschen. Es wird kein Versprechen abgegeben, dass Heilung oder sonstiger
    Erfolg stattfinden wird. Bei Beschwerden oder Krankheiten sind meine Kund*innen gebeten, sich an entsprechende
    Ärzt*innen zu wenden.
  </p></div></body></html>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('contact', () => ({
            reason: '',
            name: '',
            email: '',
            message: '',
            captcha: '',
            errors: {},
            validateAndSubmit(form) {
                // Validate the input fields
                this.errors = {};

                if (!this.reason) {
                    this.errors.reason = 'Grund wird benötigt';
                }

                if (!this.name) {
                    this.errors.name = 'Name wird benötigt';
                }

                if (!this.email.match("^\\S+@\\S+\\.\\S+$")) {
                    this.errors.email = 'Keine gültige Email Addresse';
                }

                if (this.captcha != captchaResult) {
                    this.errors.captcha = 'Eingabe nicht gültig';
                }

                // Do not continue if there are any errors
                if (Object.keys(this.errors).length !== 0) {
                    return;
                }

                // Submit the form
                fetch(form.action, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(new FormData(form))

                }).then((response) => {
                    if (!response.ok) {
                        // Redirect to error page
                        window.location.href = '/error';
                    }

                    return response.json();

                }).then((content) => {
                    // Reset the form (Needed to show empty for if user navigates back to the form)
                    const queryParamName = this.name;
                    form.reset();
                    // Handle the response content
                    // Check the STATUSCODE in the response content (200 is send for success)
                    if (content.STATUSCODE === 200) {
                        // Redirect to success page
                        window.location.href = `/Success?name=${queryParamName}`;
                    } else {
                        // Redirect to error page
                        window.location.href = '/Error';
                    }

                }).catch((error) => {
                    // Redirect to error page
                    window.location.href = '/Error';
                });
            }
        }));
    });
</script>